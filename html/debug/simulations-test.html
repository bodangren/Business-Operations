<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Simulations Test Suite | Debug</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/textbook.css">
    <link rel="stylesheet" href="../assets/css/callouts.css">
    
    <style>
        .debug-panel {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .debug-section {
            margin: 40px 0;
            padding: 20px;
            border-left: 4px solid #6f42c1;
            background: #f8f9fa;
        }
        
        .test-container {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
            position: relative;
            z-index: 1;
        }
        
        .error-log {
            background: #ffebee;
            border: 1px solid #f44336;
            color: #c62828;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .success-log {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            color: #2e7d32;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .test-button {
            background: #6f42c1;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            position: relative;
            z-index: 10;
        }
        
        .test-button:hover {
            background: #5a359a;
        }
        
        .debug-info {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .component-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
            margin: 5px;
        }
        
        .status-loaded { background: #d4edda; color: #155724; }
        .status-error { background: #f8d7da; color: #721c24; }
        .status-pending { background: #fff3cd; color: #856404; }
        
        .simulation-test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .simulation-test-item {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: white;
            position: relative;
            z-index: 1;
        }
        
        .test-result {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
        }

        .simulation-container {
            min-height: 500px;
            margin: 15px 0;
            border: 1px solid #eee;
            border-radius: 6px;
            background: #fafafa;
            position: relative;
            z-index: 2;
        }
        
        /* Ensure test buttons appear above simulations */
        .debug-panel {
            position: relative;
            z-index: 15;
        }
        
        .simulation-controls {
            position: relative;
            z-index: 10;
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container">
            <h1>🎮 Business Simulations Test Suite</h1>
            <p>Comprehensive testing and debugging for interactive business simulation games</p>
        </div>
    </header>

    <main id="main-content" class="main-content">
        <div class="container">
            <div class="content-wrapper">
                <div class="main-content-area">
                    
                    <!-- Debug Information Panel -->
                    <div class="debug-panel">
                        <h2>🚨 Debug Information</h2>
                        <div id="system-info"></div>
                        <div id="component-status"></div>
                        <div id="error-console"></div>
                        
                        <h3>Quick Test Actions</h3>
                        <button class="test-button" onclick="runAllSimulationTests()">Run All Tests</button>
                        <button class="test-button" onclick="clearLogs()">Clear Logs</button>
                        <button class="test-button" onclick="generateTestSummary()">Generate Test Summary</button>
                        <button class="test-button" onclick="testSimulationSystem()">Test Simulation System</button>
                        <button class="test-button" onclick="testAllSimulationTypes()">Test All Simulation Types</button>
                        <button class="test-button" onclick="testGameState()">Test Game State</button>
                        <button class="test-button" onclick="resetAllSimulations()">Reset All Simulations</button>
                    </div>

                    <!-- Test Section 1: Simulation System -->
                    <div class="debug-section">
                        <h2>Test 1: Business Simulation System Loading</h2>
                        <div class="debug-info">
                            <strong>Purpose:</strong> Test business-simulations.js loading and initialization<br>
                            <strong>Expected:</strong> BusinessSimulations namespace loads with all simulation types available
                        </div>
                        
                        <div class="test-container">
                            <h3>System Status</h3>
                            <div id="simulation-status"></div>
                            
                            <div class="debug-panel">
                                <h4>System Test Actions:</h4>
                                <button class="test-button" onclick="testSimulationLoading()">Check Simulation Loading</button>
                                <button class="test-button" onclick="testSimulationTypes()">Test Simulation Types</button>
                                <button class="test-button" onclick="testGameFunctions()">Test Game Functions</button>
                                <button class="test-button" onclick="testLocalStorage()">Test Local Storage</button>
                                
                                <div id="simulation-test-results" class="test-result"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Test Section 2: Lemonade Stand Simulation -->
                    <div class="debug-section">
                        <h2>Test 2: Lemonade Stand Simulation</h2>
                        <div class="debug-info">
                            <strong>Purpose:</strong> Test lemonade stand business simulation with inventory, pricing, and profit calculations<br>
                            <strong>Expected:</strong> Full game mechanics with buying supplies, setting recipes, weather effects, and daily sales
                        </div>
                        
                        <div class="simulation-test-grid">
                            <div class="simulation-test-item">
                                <h4>Lemonade Stand Test</h4>
                                <div class="simulation-container" id="lemonade-stand-test"></div>
                                <button class="test-button" onclick="testLemonadeStand()">Test Lemonade Stand</button>
                                <button class="test-button" onclick="testLemonadeGame()">Test Game Mechanics</button>
                                <div id="lemonade-stand-results" class="test-result"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Test Section 3: Startup Journey Simulation -->
                    <div class="debug-section">
                        <h2>Test 3: Startup Journey Simulation</h2>
                        <div class="debug-info">
                            <strong>Purpose:</strong> Test startup journey simulation with funding decisions, growth stages, and strategic choices<br>
                            <strong>Expected:</strong> Decision-based gameplay with funding scenarios, user growth, and business progression
                        </div>
                        
                        <div class="simulation-test-grid">
                            <div class="simulation-test-item">
                                <h4>Startup Journey Test</h4>
                                <div class="simulation-container" id="startup-journey-test"></div>
                                <button class="test-button" onclick="testStartupJourney()">Test Startup Journey</button>
                                <button class="test-button" onclick="testStartupDecisions()">Test Decision System</button>
                                <div id="startup-journey-results" class="test-result"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Test Section 4: Cash Flow Challenge -->
                    <div class="debug-section">
                        <h2>Test 4: Cash Flow Challenge Simulation</h2>
                        <div class="debug-info">
                            <strong>Purpose:</strong> Test cash flow management simulation with incoming/outgoing payments and cash position tracking<br>
                            <strong>Expected:</strong> Cash flow timeline, payment scheduling, and cash position monitoring over 30 days
                        </div>
                        
                        <div class="simulation-test-grid">
                            <div class="simulation-test-item">
                                <h4>Cash Flow Challenge Test</h4>
                                <div class="simulation-container" id="cash-flow-test"></div>
                                <button class="test-button" onclick="testCashFlowChallenge()">Test Cash Flow Challenge</button>
                                <button class="test-button" onclick="testCashFlowActions()">Test Action System</button>
                                <div id="cash-flow-results" class="test-result"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Test Section 5: Game State & Persistence -->
                    <div class="debug-section">
                        <h2>Test 5: Game State & Data Persistence</h2>
                        <div class="debug-info">
                            <strong>Purpose:</strong> Test game state management, local storage persistence, and save/load functionality<br>
                            <strong>Expected:</strong> Proper game state tracking, localStorage integration, and data persistence across sessions
                        </div>
                        
                        <div class="test-container">
                            <h3>Game State Testing</h3>
                            
                            <div class="debug-panel">
                                <h4>Game State Test Actions:</h4>
                                <button class="test-button" onclick="testGameStateCreation()">Test Game State Creation</button>
                                <button class="test-button" onclick="testLocalStoragePersistence()">Test Local Storage</button>
                                <button class="test-button" onclick="testGameStateUpdates()">Test State Updates</button>
                                <button class="test-button" onclick="testGameReset()">Test Game Reset</button>
                                <button class="test-button" onclick="testSimulationInstances()">Test Simulation Instances</button>
                                
                                <div id="gamestate-test-results" class="test-result"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Test Section 6: Performance & Integration -->
                    <div class="debug-section">
                        <h2>Test 6: Performance & Integration Tests</h2>
                        <div class="debug-info">
                            <strong>Purpose:</strong> Test performance with multiple simulations, memory usage, and integration with other systems<br>
                            <strong>Expected:</strong> Good performance, proper cleanup, and integration with gamification systems
                        </div>
                        
                        <div class="test-container">
                            <h3>Performance & Integration Testing</h3>
                            
                            <div class="debug-panel">
                                <h4>Performance Test Actions:</h4>
                                <button class="test-button" onclick="testMultipleSimulations()">Create Multiple Simulations</button>
                                <button class="test-button" onclick="testSimulationCleanup()">Test Simulation Cleanup</button>
                                <button class="test-button" onclick="testMemoryUsage()">Monitor Memory Usage</button>
                                <button class="test-button" onclick="testNotificationSystem()">Test Notification System</button>
                                <button class="test-button" onclick="testGameAnimations()">Test Game Animations</button>
                                <button class="test-button" onclick="testMobileCompatibility()">Test Mobile Compatibility</button>
                                
                                <div id="performance-test-results" class="test-result"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Test Results Summary -->
                    <div class="debug-section">
                        <h2>📊 Test Results Summary</h2>
                        
                        <div class="debug-panel">
                            <h4>Test Results (Copy/Paste Ready)</h4>
                            <textarea id="test-results-output" style="width: 100%; height: 200px; font-family: monospace; font-size: 12px;" readonly placeholder="Click 'Generate Test Summary' to see results here..."></textarea>
                        </div>
                        
                        <div class="debug-panel">
                            <h4>Full Debug Data (JSON)</h4>
                            <textarea id="debug-data-output" style="width: 100%; height: 300px; font-family: monospace; font-size: 11px;" readonly placeholder="Click 'Generate Full Debug Data' to see JSON data here..."></textarea>
                        </div>
                        
                        <button class="test-button" onclick="generateFullDebugData()">Generate Full Debug Data</button>
                    </div>

                    <!-- Error Log Section -->
                    <div class="debug-section">
                        <h2>🐛 Error Log & Console Output</h2>
                        <div id="error-log" class="error-log">No errors logged yet...</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- JavaScript -->
    <script src="../assets/js/business-simulations.js"></script>
    
    <script>
        // Debug logging system
        let debugLog = [];
        let testResults = {};
        let performanceMetrics = {};
        let localSimulationInstances = {};

        function logDebug(type, message) {
            const timestamp = new Date().toISOString();
            debugLog.push({ type, message, timestamp });
            
            const errorLog = document.getElementById('error-log');
            if (errorLog) {
                errorLog.textContent = debugLog.map(log => 
                    `[${log.timestamp}] ${log.type}: ${log.message}`
                ).join('\n');
                errorLog.scrollTop = errorLog.scrollHeight;
            }
        }

        function clearLogs() {
            debugLog = [];
            document.getElementById('error-log').textContent = 'Logs cleared...';
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            logDebug('LOG', 'Business Simulations debug page loaded, initializing...');
            updateSystemInfo();
            updateComponentStatus();
            
            setTimeout(() => {
                logDebug('LOG', 'Initial setup completed');
            }, 2000);
        });

        function updateSystemInfo() {
            const systemInfo = document.getElementById('system-info');
            const info = {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                screenResolution: `${screen.width}x${screen.height}`,
                windowSize: `${window.innerWidth}x${window.innerHeight}`,
                memoryInfo: navigator.deviceMemory ? `${navigator.deviceMemory}GB` : 'Not available',
                timestamp: new Date().toISOString()
            };
            
            systemInfo.innerHTML = `
                <h4>System Information</h4>
                <small>
                    Browser: ${info.userAgent}<br>
                    Platform: ${info.platform}<br>
                    Language: ${info.language}<br>
                    Screen: ${info.screenResolution}<br>
                    Window: ${info.windowSize}<br>
                    Memory: ${info.memoryInfo}<br>
                    Timestamp: ${info.timestamp}
                </small>
            `;
        }

        function updateComponentStatus() {
            const statusDiv = document.getElementById('component-status');
            let statusHTML = '<h4>Component Status</h4>';
            
            // Check BusinessSimulations
            const components = [
                { name: 'BusinessSimulations', obj: window.BusinessSimulations },
                { name: 'simulationInstances', obj: window.simulationInstances },
                { name: 'gameState', obj: window.gameState },
                { name: 'createBusinessSimulation', obj: window.BusinessSimulations?.createBusinessSimulation },
                { name: 'buySupply', obj: window.buySupply },
                { name: 'startDay', obj: window.startDay },
                { name: 'makeDecision', obj: window.makeDecision },
                { name: 'advanceDay', obj: window.advanceDay }
            ];
            
            components.forEach(component => {
                const status = component.obj ? 'LOADED' : 'NOT LOADED';
                const statusClass = component.obj ? 'status-loaded' : 'status-error';
                statusHTML += `<span class="component-status ${statusClass}">${component.name}: ${status}</span><br>`;
            });
            
            statusDiv.innerHTML = statusHTML;
        }
        
        // Simulation system tests
        function testSimulationLoading() {
            const results = [];
            
            if (window.BusinessSimulations) {
                results.push('✓ BusinessSimulations namespace loaded');
                
                const methods = [
                    'createBusinessSimulation'
                ];
                
                methods.forEach(method => {
                    if (typeof window.BusinessSimulations[method] === 'function') {
                        results.push(`✓ ${method} method available`);
                    } else {
                        results.push(`✗ ${method} method missing`);
                    }
                });
                
                // Check for simulation instances and game state
                if (window.simulationInstances) {
                    results.push('✓ simulationInstances global available');
                } else {
                    results.push('✗ simulationInstances global missing');
                }
                
                if (window.gameState) {
                    results.push('✓ gameState global available');
                } else {
                    results.push('✗ gameState global missing');
                }
                
            } else {
                results.push('✗ BusinessSimulations not loaded');
            }
            
            document.getElementById('simulation-test-results').innerHTML = results.join('<br>');
            testResults.simulation_loading = results;
        }
        
        function testSimulationTypes() {
            const results = [];
            // Test only implemented simulation types based on the code analysis
            const simulationTypes = [
                'lemonade-stand',
                'startup-journey', 
                'cash-flow-challenge',
                'inventory-manager',
                'budget-balancer'
            ];
            
            if (!window.BusinessSimulations) {
                results.push('✗ BusinessSimulations not available for testing');
                document.getElementById('simulation-test-results').innerHTML += '<br><strong>Simulation Type Tests:</strong><br>' + results.join('<br>');
                return;
            }
            
            simulationTypes.forEach(type => {
                try {
                    // Create a temporary container to test
                    const testContainer = document.createElement('div');
                    testContainer.style.display = 'none';
                    document.body.appendChild(testContainer);
                    
                    window.BusinessSimulations.createBusinessSimulation(testContainer, type, `test-${type}`);
                    
                    // Check if the simulation was actually created correctly
                    const hasContent = testContainer.innerHTML.trim().length > 0;
                    const hasExpectedClass = testContainer.querySelector('.simulation-container');
                    
                    if (hasContent && hasExpectedClass) {
                        results.push(`✓ ${type} simulation type works`);
                    } else {
                        results.push(`⚠ ${type} simulation type created but may have issues`);
                    }
                    
                    // Clean up
                    document.body.removeChild(testContainer);
                    
                } catch (error) {
                    results.push(`✗ ${type} simulation type failed: ${error.message}`);
                    logDebug('ERROR', `Simulation creation failed: ${error.message}`);
                }
            });
            
            document.getElementById('simulation-test-results').innerHTML += '<br><strong>Simulation Type Tests:</strong><br>' + results.join('<br>');
            testResults.simulation_types = results;
        }
        
        function testGameFunctions() {
            const results = [];
            
            // Test if global game functions exist
            const gameFunctions = [
                'buySupply',
                'updateRecipe', 
                'startDay',
                'endDay',
                'makeDecision',
                'advanceDay',
                'resetGame'
            ];
            
            gameFunctions.forEach(func => {
                if (typeof window[func] === 'function') {
                    results.push(`✓ ${func} function available`);
                } else {
                    results.push(`✗ ${func} function missing`);
                }
            });
            
            document.getElementById('simulation-test-results').innerHTML += '<br><strong>Game Function Tests:</strong><br>' + results.join('<br>');
            testResults.game_functions = results;
        }
        
        function testLocalStorage() {
            const results = [];
            
            try {
                // Test localStorage availability
                if (typeof Storage !== 'undefined') {
                    results.push('✓ localStorage API available');
                    
                    // Test writing to localStorage
                    const testKey = 'business-sim-test';
                    const testData = { test: 'data', timestamp: Date.now() };
                    localStorage.setItem(testKey, JSON.stringify(testData));
                    
                    // Test reading from localStorage
                    const retrievedData = JSON.parse(localStorage.getItem(testKey));
                    if (retrievedData && retrievedData.test === 'data') {
                        results.push('✓ localStorage read/write works');
                    } else {
                        results.push('✗ localStorage read/write failed');
                    }
                    
                    // Clean up
                    localStorage.removeItem(testKey);
                    results.push('✓ localStorage cleanup successful');
                    
                } else {
                    results.push('✗ localStorage not available');
                }
                
            } catch (error) {
                results.push(`✗ localStorage test failed: ${error.message}`);
            }
            
            document.getElementById('simulation-test-results').innerHTML += '<br><strong>Local Storage Tests:</strong><br>' + results.join('<br>');
            testResults.local_storage = results;
        }
        
        // Simulation testing functions
        function testLemonadeStand() {
            const container = document.getElementById('lemonade-stand-test');
            const results = testSimulationContainer(container, 'lemonade-stand', 'lemonade-test');
            document.getElementById('lemonade-stand-results').innerHTML = results.join('<br>');
            testResults.lemonade_stand = results;
        }
        
        function testStartupJourney() {
            const container = document.getElementById('startup-journey-test');
            const results = testSimulationContainer(container, 'startup-journey', 'startup-test');
            document.getElementById('startup-journey-results').innerHTML = results.join('<br>');
            testResults.startup_journey = results;
        }
        
        function testCashFlowChallenge() {
            const container = document.getElementById('cash-flow-test');
            const results = testSimulationContainer(container, 'cash-flow-challenge', 'cashflow-test');
            document.getElementById('cash-flow-results').innerHTML = results.join('<br>');
            testResults.cash_flow = results;
        }
        
        function testSimulationContainer(container, simulationType, simulationId) {
            const results = [];
            
            if (!container) {
                results.push('✗ Simulation container not found');
                return results;
            }
            
            results.push('✓ Simulation container found');
            
            // Clear container
            container.innerHTML = '';
            
            if (!window.BusinessSimulations) {
                results.push('✗ BusinessSimulations not available');
                return results;
            }
            
            try {
                // Create simulation
                window.BusinessSimulations.createBusinessSimulation(container, simulationType, simulationId);
                results.push(`✓ ${simulationType} simulation created`);
                
                // Check for expected elements
                setTimeout(() => {
                    const simulationContainer = container.querySelector('.simulation-container');
                    const statCards = container.querySelectorAll('.stat-card');
                    const buttons = container.querySelectorAll('button');
                    const inputs = container.querySelectorAll('input');
                    
                    if (simulationContainer) {
                        results.push('✓ Simulation container structure created');
                    } else {
                        results.push('✗ Simulation container structure missing');
                    }
                    
                    results.push(`✓ Found ${statCards.length} stat cards`);
                    results.push(`✓ Found ${buttons.length} action buttons`);
                    results.push(`✓ Found ${inputs.length} input controls`);
                    
                    // Check simulation registration
                    if (window.simulationInstances && window.simulationInstances[simulationId]) {
                        results.push('✓ Simulation registered in global instances');
                        const instance = window.simulationInstances[simulationId];
                        results.push(`Type: ${instance.type}`);
                        results.push(`Active: ${instance.active}`);
                        results.push(`Score: ${instance.score}`);
                    } else {
                        results.push('✗ Simulation not registered in global instances');
                    }
                    
                    // Check game state
                    if (window.gameState && window.gameState[simulationId]) {
                        results.push('✓ Game state initialized');
                    } else {
                        results.push('✗ Game state not initialized');
                    }
                    
                    // Update results display
                    const resultsContainer = document.getElementById(`${simulationType.replace('-', '-')}-results`);
                    if (resultsContainer) {
                        resultsContainer.innerHTML = results.join('<br>');
                    }
                    
                }, 500);
                
            } catch (error) {
                results.push(`✗ Error creating ${simulationType}: ${error.message}`);
                logDebug('ERROR', `Simulation creation failed: ${error.message}`);
            }
            
            return results;
        }
        
        // Game mechanics testing
        function testLemonadeGame() {
            const results = ['Testing lemonade stand game mechanics...'];
            // Test game mechanics like buying supplies, setting recipes, etc.
            document.getElementById('lemonade-stand-results').innerHTML += '<br><strong>Game Mechanics:</strong><br>' + results.join('<br>');
        }
        
        function testStartupDecisions() {
            const results = ['Testing startup decision system...'];
            // Test decision making mechanics
            document.getElementById('startup-journey-results').innerHTML += '<br><strong>Decision System:</strong><br>' + results.join('<br>');
        }
        
        function testCashFlowActions() {
            const results = ['Testing cash flow action system...'];
            // Test cash flow management actions
            document.getElementById('cash-flow-results').innerHTML += '<br><strong>Action System:</strong><br>' + results.join('<br>');
        }
        
        // Game state testing
        function testGameStateCreation() {
            const results = ['Game state creation testing started...'];
            document.getElementById('gamestate-test-results').innerHTML = results.join('<br>');
        }
        
        function testLocalStoragePersistence() {
            const results = ['Local storage persistence testing started...'];
            document.getElementById('gamestate-test-results').innerHTML += '<br>' + results.join('<br>');
        }
        
        function testGameStateUpdates() {
            const results = ['Game state updates testing started...'];
            document.getElementById('gamestate-test-results').innerHTML += '<br>' + results.join('<br>');
        }
        
        function testGameReset() {
            const results = ['Game reset testing started...'];
            document.getElementById('gamestate-test-results').innerHTML += '<br>' + results.join('<br>');
        }
        
        function testSimulationInstances() {
            const results = [];
            
            if (window.simulationInstances) {
                const instanceCount = Object.keys(window.simulationInstances).length;
                results.push(`✓ Found ${instanceCount} simulation instances`);
                
                Object.keys(window.simulationInstances).forEach(id => {
                    const instance = window.simulationInstances[id];
                    results.push(`  - ${id}: ${instance.type} (active: ${instance.active})`);
                });
            } else {
                results.push('✗ No simulation instances found');
            }
            
            document.getElementById('gamestate-test-results').innerHTML += '<br><strong>Simulation Instances:</strong><br>' + results.join('<br>');
        }
        
        // Performance testing
        function testMultipleSimulations() {
            const results = ['Multiple simulations performance test started...'];
            document.getElementById('performance-test-results').innerHTML = results.join('<br>');
        }
        
        function testSimulationCleanup() {
            const results = ['Simulation cleanup test started...'];
            document.getElementById('performance-test-results').innerHTML += '<br>' + results.join('<br>');
        }
        
        function testMemoryUsage() {
            const results = [];
            if (performance.memory) {
                results.push(`Used JS Heap: ${(performance.memory.usedJSHeapSize / 1048576).toFixed(2)}MB`);
                results.push(`Total JS Heap: ${(performance.memory.totalJSHeapSize / 1048576).toFixed(2)}MB`);
                results.push(`Heap Limit: ${(performance.memory.jsHeapSizeLimit / 1048576).toFixed(2)}MB`);
            } else {
                results.push('Memory info not available');
            }
            document.getElementById('performance-test-results').innerHTML += '<br><strong>Memory Usage:</strong><br>' + results.join('<br>');
        }
        
        function testNotificationSystem() {
            const results = ['Notification system testing started...'];
            document.getElementById('performance-test-results').innerHTML += '<br>' + results.join('<br>');
        }
        
        function testGameAnimations() {
            const results = ['Game animations testing started...'];
            document.getElementById('performance-test-results').innerHTML += '<br>' + results.join('<br>');
        }
        
        function testMobileCompatibility() {
            const results = ['Mobile compatibility testing started...'];
            document.getElementById('performance-test-results').innerHTML += '<br>' + results.join('<br>');
        }
        
        // Comprehensive test functions
        function runAllSimulationTests() {
            logDebug('LOG', 'Starting comprehensive business simulation test suite...');
            
            setTimeout(() => testSimulationLoading(), 100);
            setTimeout(() => testSimulationTypes(), 200);
            setTimeout(() => testGameFunctions(), 300);
            setTimeout(() => testLocalStorage(), 400);
            setTimeout(() => testLemonadeStand(), 500);
            setTimeout(() => testStartupJourney(), 600);
            setTimeout(() => testCashFlowChallenge(), 700);
            setTimeout(() => testGameStateCreation(), 800);
            setTimeout(() => testSimulationInstances(), 900);
        }
        
        function testSimulationSystem() {
            testSimulationLoading();
            setTimeout(() => testSimulationTypes(), 100);
            setTimeout(() => testGameFunctions(), 200);
            setTimeout(() => testLocalStorage(), 300);
        }
        
        function testAllSimulationTypes() {
            testLemonadeStand();
            setTimeout(() => testStartupJourney(), 100);
            setTimeout(() => testCashFlowChallenge(), 200);
        }
        
        function testGameState() {
            testGameStateCreation();
            setTimeout(() => testLocalStoragePersistence(), 100);
            setTimeout(() => testGameStateUpdates(), 200);
            setTimeout(() => testGameReset(), 300);
            setTimeout(() => testSimulationInstances(), 400);
        }
        
        function resetAllSimulations() {
            // Reset all simulation containers
            const containers = ['lemonade-stand-test', 'startup-journey-test', 'cash-flow-test'];
            containers.forEach(id => {
                const container = document.getElementById(id);
                if (container) {
                    container.innerHTML = '';
                }
            });
            logDebug('LOG', 'All simulations reset');
        }
        
        // Display functions for test results
        function generateTestSummary() {
            const summary = [];
            summary.push('=== BUSINESS SIMULATIONS TEST SUMMARY ===');
            summary.push(`Timestamp: ${new Date().toISOString()}`);
            summary.push(`Platform: ${navigator.platform}`);
            summary.push(`Browser: ${navigator.userAgent.split(' ').slice(-2).join(' ')}`);
            summary.push('');
            
            // System Status
            summary.push('SYSTEM STATUS:');
            summary.push(`✓ BusinessSimulations: ${window.BusinessSimulations ? 'LOADED' : 'NOT LOADED'}`);
            summary.push(`✓ simulationInstances: ${window.simulationInstances ? 'AVAILABLE' : 'NOT AVAILABLE'}`);
            summary.push(`✓ gameState: ${window.gameState ? 'AVAILABLE' : 'NOT AVAILABLE'}`);
            summary.push('');
            
            // Test Results
            summary.push('TEST RESULTS:');
            Object.keys(testResults).forEach(testName => {
                summary.push(`\n${testName.toUpperCase().replace(/_/g, ' ')}:`);
                testResults[testName].forEach(result => {
                    summary.push(`  ${result}`);
                });
            });
            
            // Error Summary
            const errors = debugLog.filter(log => log.type === 'ERROR');
            summary.push('\nERROR SUMMARY:');
            if (errors.length === 0) {
                summary.push('  No errors detected');
            } else {
                errors.forEach(error => {
                    summary.push(`  ❌ ${error.message}`);
                });
            }
            
            // Performance
            summary.push('\nPERFORMANE METRICS:');
            if (Object.keys(performanceMetrics).length === 0) {
                summary.push('  No performance data collected');
            } else {
                Object.keys(performanceMetrics).forEach(metric => {
                    summary.push(`  ${metric}: ${performanceMetrics[metric].toFixed(2)}ms`);
                });
            }
            
            summary.push('\n=== END TEST SUMMARY ===');
            
            document.getElementById('test-results-output').value = summary.join('\n');
        }
        
        function generateFullDebugData() {
            const data = {
                systemInfo: {
                    userAgent: navigator.userAgent,
                    platform: navigator.platform,
                    language: navigator.language,
                    screenResolution: `${screen.width}x${screen.height}`,
                    windowSize: `${window.innerWidth}x${window.innerHeight}`,
                    timestamp: new Date().toISOString()
                },
                testResults: testResults,
                performanceMetrics: performanceMetrics,
                debugLog: debugLog,
                simulationInstances: window.simulationInstances || {},
                gameState: window.gameState || {},
                componentStatus: {
                    BusinessSimulations: !!window.BusinessSimulations,
                    simulationInstancesGlobal: !!window.simulationInstances,
                    gameStateGlobal: !!window.gameState,
                    availableMethods: window.BusinessSimulations ? Object.keys(window.BusinessSimulations) : []
                }
            };
            
            document.getElementById('debug-data-output').value = JSON.stringify(data, null, 2);
            console.log('Business Simulations Test Results:', data);
        }
    </script>
</body>
</html>