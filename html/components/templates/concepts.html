<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{UNIT_TITLE}} - Concepts | Math for Business Operations</title>
    <meta name="description" content="Core concepts for {{UNIT_TITLE}} - {{UNIT_DESCRIPTION}}">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="../../assets/css/main.css">
    <link rel="stylesheet" href="../../assets/css/textbook.css">
    <link rel="stylesheet" href="../../assets/css/callouts.css">
    <link rel="stylesheet" href="../../assets/css/excel.css">
    
    <!-- Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="../../assets/images/favicon.png">
</head>
<body>
    <div class="page-container">
        <!-- Navigation -->
        <nav class="main-navigation">
            <div class="nav-container">
                <div class="nav-brand">
                    <a href="../../index.html">Math for Business Operations</a>
                </div>
                <div class="nav-unit">
                    <span>Unit {{UNIT_NUMBER}}: {{UNIT_TITLE}}</span>
                </div>
                <div class="nav-progress">
                    <div class="progress-indicator" data-unit="{{UNIT_NUMBER}}" data-section="concepts"></div>
                </div>
            </div>
        </nav>

        <!-- Breadcrumb -->
        <div class="breadcrumb">
            <a href="../../index.html">Home</a> &gt; 
            <a href="index.html">Unit {{UNIT_NUMBER}}</a> &gt; 
            <span>Concepts</span>
        </div>

        <!-- Main Content -->
        <main class="main-content" id="main-content">
            <!-- Section Header -->
            <header class="section-header">
                <div class="section-meta">
                    <span class="unit-number">Unit {{UNIT_NUMBER}}</span>
                    <span class="section-type">Concepts</span>
                </div>
                <h1 class="section-title">{{SECTION_TITLE}}</h1>
                <p class="section-subtitle">{{SECTION_SUBTITLE}}</p>
            </header>

            <!-- Learning Focus -->
            <section class="learning-focus">
                <div class="callout-box important">
                    <h3>üéØ Learning Focus</h3>
                    <p>{{LEARNING_FOCUS}}</p>
                </div>
            </section>

            <!-- Concept Overview -->
            <section class="concept-overview">
                <h2>üìö Concept Overview</h2>
                <div class="overview-content">
                    {{CONCEPT_OVERVIEW}}
                </div>
            </section>

            <!-- Core Concepts -->
            <section class="core-concepts">
                {{CORE_CONCEPTS}}
            </section>

            <!-- Interactive Demonstrations -->
            <section class="interactive-demonstrations">
                <h2>üî¨ Interactive Demonstrations</h2>
                {{INTERACTIVE_DEMONSTRATIONS}}
            </section>

            <!-- Comprehension Checks -->
            <section class="comprehension-checks">
                <h2>‚úÖ Check Your Understanding</h2>
                {{COMPREHENSION_CHECKS}}
            </section>

            <!-- Key Formulas and Principles -->
            <section class="key-formulas">
                <h2>üìê Key Formulas & Principles</h2>
                <div class="formulas-grid">
                    {{KEY_FORMULAS}}
                </div>
            </section>

            <!-- Business Context -->
            <section class="business-context">
                <h2>üíº Business Context</h2>
                <div class="callout-box example">
                    <h3>Sarah's Application</h3>
                    <div class="context-content">
                        {{BUSINESS_CONTEXT}}
                    </div>
                </div>
            </section>

            <!-- Common Misconceptions -->
            <section class="common-misconceptions">
                <h2>‚ö†Ô∏è Common Misconceptions</h2>
                <div class="misconceptions-list">
                    {{COMMON_MISCONCEPTIONS}}
                </div>
            </section>

            <!-- Gamification Widget -->
            <div class="gamification-widget" data-unit="{{UNIT_NUMBER}}" data-section="concepts">
                {{GAMIFICATION_WIDGET}}
            </div>

            <!-- Navigation -->
            <nav class="section-navigation">
                <div class="nav-buttons">
                    <a href="intro.html" class="nav-btn prev-btn">‚¨ÖÔ∏è Introduction</a>
                    <a href="excel-model.html" class="nav-btn next-btn">Excel Model ‚û°Ô∏è</a>
                </div>
                <div class="section-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 33.33%"></div>
                    </div>
                    <span class="progress-text">Section 2 of 6</span>
                </div>
            </nav>
        </main>

        <!-- Print Version -->
        <div class="print-version" style="display: none;">
            {{PRINT_VERSION}}
        </div>

        <!-- Footer -->
        <footer class="main-footer">
            <div class="footer-content">
                <p>&copy; 2024 Math for Business Operations. Interactive textbook by Daniel Bodanske.</p>
                <div class="footer-links">
                    <a href="../../frontmatter/preface.html">About</a>
                    <a href="../../teacher/index.html">Teacher Resources</a>
                    <button onclick="window.print()" class="print-btn">üñ®Ô∏è Print</button>
                </div>
            </div>
        </footer>
    </div>

    <!-- JavaScript Files -->
    <script src="../../assets/js/gamification.js"></script>
    <script src="../../assets/js/progress-tracker.js"></script>
    <script src="../../assets/js/navigation.js"></script>
    <script src="../../assets/js/data-visualization.js"></script>
    <script src="../../assets/js/exercises.js"></script>
    
    <!-- Unit-specific components -->
    {{COMPONENT_SCRIPTS}}
    
    <script>
        // Initialize page-specific features
        document.addEventListener('DOMContentLoaded', function() {
            // Track page visit
            if (window.trackProgress) {
                window.trackProgress('{{UNIT_NUMBER}}', 'concepts', 'visited');
            }
            
            // Award points for accessing concepts
            if (window.awardPoints) {
                window.awardPoints(10, 'Studying Unit {{UNIT_NUMBER}} concepts');
            }
            
            // Initialize interactive elements
            initializeConceptsPage();
        });

        function initializeConceptsPage() {
            // Add expandable concept sections
            const conceptSections = document.querySelectorAll('.concept-section');
            conceptSections.forEach(section => {
                const header = section.querySelector('.concept-header');
                const content = section.querySelector('.concept-content');
                
                if (header && content) {
                    header.addEventListener('click', function() {
                        section.classList.toggle('expanded');
                        
                        if (section.classList.contains('expanded') && window.awardPoints) {
                            window.awardPoints(3, 'Explored concept section');
                        }
                    });
                }
            });

            // Add formula hover effects
            const formulas = document.querySelectorAll('.formula-card');
            formulas.forEach(formula => {
                formula.addEventListener('mouseenter', function() {
                    this.querySelector('.formula-explanation').style.opacity = '1';
                });
                
                formula.addEventListener('mouseleave', function() {
                    this.querySelector('.formula-explanation').style.opacity = '0';
                });
            });

            // Initialize interactive demonstrations
            initializeInteractiveDemonstrations();
            
            // Add progress tracking for concept mastery
            trackConceptMastery();
        }

        function initializeInteractiveDemonstrations() {
            // Initialize any interactive demonstrations specific to this unit
            const demonstrations = document.querySelectorAll('.interactive-demo');
            demonstrations.forEach(demo => {
                const demoType = demo.dataset.type;
                
                switch(demoType) {
                    case 'chart':
                        initializeChartDemo(demo);
                        break;
                    case 'calculator':
                        initializeCalculatorDemo(demo);
                        break;
                    case 'simulation':
                        initializeSimulationDemo(demo);
                        break;
                }
            });
        }

        function initializeChartDemo(demo) {
            // Initialize chart-based demonstrations
            const ctx = demo.querySelector('canvas');
            if (ctx && window.Chart) {
                const chartData = JSON.parse(demo.dataset.chartData || '{}');
                
                new Chart(ctx, {
                    type: chartData.type || 'line',
                    data: chartData.data || {},
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: chartData.title || 'Interactive Demonstration'
                            }
                        }
                    }
                });
            }
        }

        function initializeCalculatorDemo(demo) {
            // Initialize calculator-based demonstrations
            const inputs = demo.querySelectorAll('input[type="number"]');
            const outputs = demo.querySelectorAll('.calculation-output');
            
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    updateCalculations(demo);
                });
            });
        }

        function initializeSimulationDemo(demo) {
            // Initialize simulation-based demonstrations
            const startBtn = demo.querySelector('.start-simulation');
            const resetBtn = demo.querySelector('.reset-simulation');
            
            if (startBtn) {
                startBtn.addEventListener('click', function() {
                    runSimulation(demo);
                });
            }
            
            if (resetBtn) {
                resetBtn.addEventListener('click', function() {
                    resetSimulation(demo);
                });
            }
        }

        function updateCalculations(demo) {
            // Update calculations in real-time
            const inputs = demo.querySelectorAll('input[type="number"]');
            const formula = demo.dataset.formula;
            
            if (formula) {
                // Evaluate formula safely
                try {
                    const result = evaluateFormula(formula, inputs);
                    demo.querySelector('.calculation-output').textContent = result;
                } catch (error) {
                    console.error('Formula evaluation error:', error);
                }
            }
        }

        function evaluateFormula(formula, inputs) {
            // Safe formula evaluation
            // Replace input placeholders with actual values
            let processedFormula = formula;
            inputs.forEach((input, index) => {
                const placeholder = `input${index + 1}`;
                const value = parseFloat(input.value) || 0;
                processedFormula = processedFormula.replace(new RegExp(placeholder, 'g'), value);
            });
            
            // Use safe evaluation (avoid eval())
            return Function('"use strict"; return (' + processedFormula + ')')();
        }

        function runSimulation(demo) {
            // Run interactive simulation
            demo.classList.add('simulation-running');
            
            // Award points for interaction
            if (window.awardPoints) {
                window.awardPoints(5, 'Ran interactive simulation');
            }
        }

        function resetSimulation(demo) {
            // Reset simulation to initial state
            demo.classList.remove('simulation-running');
            
            // Reset all inputs and outputs
            const inputs = demo.querySelectorAll('input');
            const outputs = demo.querySelectorAll('.output');
            
            inputs.forEach(input => input.value = '');
            outputs.forEach(output => output.textContent = '');
        }

        function trackConceptMastery() {
            // Track student engagement with concepts
            let conceptsViewed = 0;
            const totalConcepts = document.querySelectorAll('.concept-section').length;
            
            document.addEventListener('conceptViewed', function() {
                conceptsViewed++;
                
                if (conceptsViewed === totalConcepts && window.awardPoints) {
                    window.awardPoints(15, 'Mastered all Unit {{UNIT_NUMBER}} concepts');
                }
            });
        }
    </script>
</body>
</html>